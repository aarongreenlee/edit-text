<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>System Overview - </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <style>
            /* Hide empty links*/
            a[href="#.html"] { opacity: 0.5; pointer-events: none; }

            /* svgbob monospace */
            svg.bob { font-family: Monaco, monospace; display: block; margin: 1.6em auto; padding: 2em 3em; }
            svg.bob text { transform: translateX(-2px); }

            p > img:first-child, svg.bob { display: block; border: 1px solid #bbb; }
            table, table th, table td { border-collapse: collapse; border: 1px solid #bbb; }
            table th { padding: 0.2em 1.5em }

            /* header spacing */
            h2, h3 { margin-top: 1.6em; }

            main { line-height: 1.5; }
        </style>

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">var path_to_root = "";</script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="intro.html"><strong aria-hidden="true">1.</strong> edit-text</a></li><li><ol class="section"><li><a href="getting-started.html"><strong aria-hidden="true">1.1.</strong> Getting Started</a></li></ol></li><li><a href="development.html"><strong aria-hidden="true">2.</strong> Development</a></li><li><ol class="section"><li><a href="intro-system.html" class="active"><strong aria-hidden="true">2.1.</strong> System Overview</a></li><li><a href="intro-x.html"><strong aria-hidden="true">2.2.</strong> Build System ./tools</a></li><li><a href="intro-testing.html"><strong aria-hidden="true">2.3.</strong> Tests</a></li><li><ol class="section"><li><a href="#.html"><strong aria-hidden="true">2.3.1.</strong> Writing an integration test</a></li></ol></li></ol></li><li><a href="editor-basics.html"><strong aria-hidden="true">3.</strong> Editor Basics</a></li><li><ol class="section"><li><a href="working-with-documents.html"><strong aria-hidden="true">3.1.</strong> Documents</a></li><li><a href="working-with-operations.html"><strong aria-hidden="true">3.2.</strong> Operations</a></li><li><a href="rtf-ot.html"><strong aria-hidden="true">3.3.</strong> Operational Transform</a></li></ol></li><li><a href="rtf.html"><strong aria-hidden="true">4.</strong> Rich Text</a></li><li><ol class="section"><li><a href="markdown.html"><strong aria-hidden="true">4.1.</strong> Markdown</a></li><li><a href="diary-carets.html"><strong aria-hidden="true">4.2.</strong> Carets</a></li></ol></li><li><a href="server.html"><strong aria-hidden="true">5.</strong> Server</a></li><li><ol class="section"><li><a href="server-apis.html"><strong aria-hidden="true">5.1.</strong> HTTP APIs</a></li><li><a href="storage.html"><strong aria-hidden="true">5.2.</strong> Storage</a></li></ol></li><li><a href="frontend.html"><strong aria-hidden="true">6.</strong> Frontend</a></li><li><ol class="section"><li><a href="editor-component.html"><strong aria-hidden="true">6.1.</strong> Editor Component</a></li><li><a href="webassembly-interface.html"><strong aria-hidden="true">6.2.</strong> WebAssembly Interface</a></li></ol></li><li><a href="deploying.html"><strong aria-hidden="true">7.</strong> Deploying</a></li><li><ol class="section"><li><a href="edit-server-binary.html"><strong aria-hidden="true">7.1.</strong> Running as a binary</a></li><li><a href="dokku.html"><strong aria-hidden="true">7.2.</strong> Dokku</a></li><li><a href="#.html"><strong aria-hidden="true">7.3.</strong> Hosted Sandbox</a></li><li><a href="#.html"><strong aria-hidden="true">7.4.</strong> npm module</a></li></ol></li><li><a href="appendix.html"><strong aria-hidden="true">8.</strong> Appendix</a></li><li><ol class="section"><li><a href="diary-delall.html"><strong aria-hidden="true">8.1.</strong> Delall Hack</a></li><li><a href="glossary.html"><strong aria-hidden="true">8.2.</strong> Glossary</a></li></ol></li></ol>
            <div class="chapter">
                <div>Crate documentation:</div>
                <ul class="section" style="margin-top: -0.25em">
                    <li><a href="/crates/oatie/">oatie</a></li>
                    <li><a href="/crates/edit_common/">edit-common</a></li>
                    <li><a href="/crates/edit_client/">edit-client</a></li>
                    <li><a href="/crates/edit_server/">edit-server</a></li>
                </ul>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                            <a id="edit-toggle" class="icon-button" title="Edit page" aria-label="Edit page" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list" href="https://github.com/tcr/edit-text/edit/master/docs/src/intro-system.md?message=Updating docs for intro-system.md" style="text-decoration: none">
                                <i class="fa fa-pencil"></i> EDIT
                            </a>
                        </div>

                        <h1 class="menu-title"></h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#system-overview" id="system-overview"><h1>System Overview</h1></a>
<p>edit-text is built from the ground up as a collaborative text editor. It uses
operational transform to merge updates from multiple clients, so it requires a
synchronizing server. The server is also in charge of storing page content, so
that every page can be shared via its URL.</p>
<p>There are four components in the system:</p>
<ul>
<li>
<p>The <strong>Server</strong>, which serves HTTP content, a GraphQL endpoint for performing
page-level commands, and a WebSocket endpoint for synchronizing document
content.</p>
</li>
<li>
<p>The <strong>Client</strong>, which can connect to a server and synchronize its document
content. It sends client-side modifications (in the form of operations) to the
server, and receives updated content (in the form of operations) from the server
after any client submits an update.</p>
</li>
<li>
<p>The <strong>Controller</strong>, which receives UI-level event updates from the frontend
and converts it into operations on the client document.</p>
</li>
<li>
<p>The <strong>Frontend</strong>, which is the editor UI. The current document is rendered
as a component inside the frontend, and interactions with this component are
forwarded to the controller. The frontend also manages the toolbar,
notifications, and dialog boxes.</p>
</li>
</ul>
<p>Each of these four components can be controlled by their <strong>commands</strong>, defined
in <code>commands.rs</code>, effectively providing an asynchronous API for each component
in the system.</p>
<p>Here is a diagram representing communication between the Server, Client,
Controller, and Frontend:</p>
<p><svg class="bob" font-family="arial" font-size="14" height="208" width="608" xmlns="http://www.w3.org/2000/svg"> <defs> <marker id="triangle" markerHeight="8" markerWidth="8" orient="auto" refX="4" refY="2" viewBox="0 0 8 4"> <polygon class="fg_fill" points="0,0 0,4 8,2 0,0"/> </marker> <marker id="clear_triangle" markerHeight="10" markerWidth="10" orient="auto" refX="1" refY="7" viewBox="0 0 20 14"> <polygon class="bg_fill" points="2,2 2,12 18,7 2,2"/> </marker> <marker id="circle" markerHeight="5" markerWidth="5" orient="auto" refX="10" refY="10" viewBox="0 0 20 20"> <circle class="fg_fill" cx="10" cy="10" r="8"/> </marker> <marker id="square" markerHeight="5" markerWidth="5" orient="auto" refX="10" refY="10" viewBox="0 0 20 20"> <rect class="fg_fill" height="20" width="20" x="0" y="0"/> </marker> <marker id="open_circle" markerHeight="10" markerWidth="10" orient="auto" refX="10" refY="10" viewBox="0 0 20 20"> <circle class="bg_fill" cx="10" cy="10" r="4"/> </marker> <marker id="big_open_circle" markerHeight="20" markerWidth="20" orient="auto" refX="20" refY="20" viewBox="0 0 40 40"> <circle class="bg_fill" cx="20" cy="20" r="6"/> </marker> </defs> <style type="text/css">  rect.backdrop {     fill: white; } text{     fill: black; }  circle {     fill: none;     stroke: black;     stroke-width: 2; }  line {     stroke: black;     stroke-width: 2;     stroke-opacity: 1;     fill-opacity: 1;     stroke-linecap: round;     stroke-linejoin: miter; }  path {     fill: none;     stroke: black;     stroke-width: 2;     stroke-opacity: 1;     fill-opacity: 1;     stroke-linecap: round;     stroke-linejoin: miter; }  line.dashed {     stroke-dasharray: 5; }  .fg_fill {     fill: black; }   .bg_fill {     fill: white;     stroke: black;     stroke-width: 2; }  tspan.head{     fill: none;     stroke: none; }      </style> <rect class="backdrop" height="208" width="608" x="0" y="0"/> <g> <line x1="4" x2="4" y1="8" y2="72"/> <line x1="4" x2="92" y1="8" y2="8"/> <line x1="4" x2="92" y1="72" y2="72"/> <line x1="92" x2="92" y1="8" y2="72"/> </g> <g> <line marker-end="url(#triangle)" x1="112" x2="108" y1="40" y2="40"/> <line x1="112" x2="132" y1="40" y2="40"/> <line x1="132" x2="132" y1="40" y2="200"/> <line marker-end="url(#triangle)" x1="132" x2="164" y1="40" y2="40"/> <line marker-end="url(#triangle)" x1="132" x2="180" y1="200" y2="200"/> </g> <g> <line marker-end="url(#triangle)" x1="132" x2="180" y1="136" y2="136"/> </g> <g> <line marker-end="url(#triangle)" x1="132" x2="180" y1="168" y2="168"/> </g> <g> <line x1="172" x2="172" y1="8" y2="72"/> <line x1="172" x2="292" y1="8" y2="8"/> <line x1="172" x2="292" y1="72" y2="72"/> <line x1="292" x2="292" y1="8" y2="72"/> <line x1="292" x2="412" y1="8" y2="8"/> <line x1="292" x2="412" y1="72" y2="72"/> <line x1="412" x2="412" y1="8" y2="72"/> </g> <g> <line marker-end="url(#triangle)" x1="424" x2="420" y1="40" y2="40"/> <line marker-end="url(#triangle)" x1="424" x2="476" y1="40" y2="40"/> </g> <g> <line x1="484" x2="484" y1="8" y2="72"/> <line x1="484" x2="604" y1="8" y2="8"/> <line x1="484" x2="604" y1="72" y2="72"/> <line x1="604" x2="604" y1="8" y2="72"/> </g> <g> <text x="25" y="44"> Server </text> </g> <g> <text x="25" y="92"> (Rust) </text> </g> <g> <text x="193" y="140"> Client </text> </g> <g> <text x="193" y="172"> Client </text> </g> <g> <text x="193" y="204"> ... </text> </g> <g> <text x="201" y="44"> Client </text> </g> <g> <text x="217" y="92"> (Rust </text> </g> <g> <text x="249" y="140"> B </text> </g> <g> <text x="249" y="172"> C </text> </g> <g> <text x="257" y="44"> A </text> </g> <g> <text x="265" y="92"> + </text> </g> <g> <text x="281" y="92"> WebAssembly) </text> </g> <g> <text x="313" y="44"> Controller </text> </g> <g> <text x="497" y="92"> (TypeScript) </text> </g> <g> <text x="513" y="44"> Frontend </text> </g> </svg></p>
<p>Notice that <strong>Client</strong> and <strong>Controller</strong> are part of the same component. This is useful
from an API perspective: commands that are addressed to the client will always
originate from the server, and commands addressed to the Controller will always
originate from the frontend. On the implementation level, however, Client and
Controller are the same process.</p>
<p>The server is a command-line program called <code>edit-server</code>. In release mode, it
bundles all client-side code and can be uploaded to a server to run the program
directly.</p>
<p>The edit-text client is written in Rust and can be run both in the browser (to
power the editor) or from the command line (for tools like the client proxy, and client replay).
If you use edit-text in its normal configuration, the Client, Controller, and
Frontend all run in your browser as WebAssembly and JavaScript. In proxy mode,
the Client and Controller run as a command line program.</p>
<p>The Frontend is written in TypeScript.</p>
<a class="header" href="#cratemodule-overview" id="cratemodule-overview"><h2>Crate/Module overview</h2></a>
<p>The top-level crates/modules are these:</p>
<ul>
<li><code>oatie/</code> is the operational transform library</li>
<li><code>edit-common/</code> contains code shared by all edit-* crates</li>
<li><code>edit-client/</code> contains the Client and Controller</li>
<li><code>edit-server/</code> contains the Server binary</li>
<li><code>edit-frontend/</code> contains the Frontend code as a Node module compiled with webpack</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="development.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="intro-x.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="development.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="intro-x.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
